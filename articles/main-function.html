<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The supercells() function • supercells</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The supercells() function">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">supercells</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/benchmarks.html">Benchmarks of the supercells package</a></li>
    <li><a class="dropdown-item" href="../articles/experimental.html">Experimental features of the supercells package</a></li>
    <li><a class="dropdown-item" href="../articles/main-function.html">The supercells() function</a></li>
    <li><a class="dropdown-item" href="../articles/motifels.html">Superpixels of spatial categorical patterns</a></li>
    <li><a class="dropdown-item" href="../articles/one_var.html">Superpixels of a single raster layer</a></li>
    <li><a class="dropdown-item" href="../articles/rgb_vars.html">Superpixels of an RGB raster</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Nowosad/supercells/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The supercells() function</h1>
                        <h4 data-toc-skip class="author">Jakub
Nowosad</h4>
            
            <h4 data-toc-skip class="date">2024-08-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Nowosad/supercells/blob/master/vignettes/articles/main-function.Rmd" class="external-link"><code>vignettes/articles/main-function.Rmd</code></a></small>
      <div class="d-none name"><code>main-function.Rmd</code></div>
    </div>

    
    
<p>The main function in this package <span class="citation">(Nowosad and
Stepinski 2022)</span> is called <code><a href="../reference/supercells.html">supercells()</a></code>. An overview
of its arguments is shown in the table below.</p>
<p>This function expects raster data with one or more layers
(representing, for example, different bands, variables, or dates) in the
form of a <strong>terra</strong>’s <code>SpatRaster</code> object or a
<strong>stars</strong>’s <code>stars</code> object. The resulting
superpixels are stored as <code>sf</code> polygons with four or more
columns containing identification numbers of superpixels, y and x
coordinates of their centroids, and one or more columns with average
values of variables for each superpixel.</p>
<p>The number of resulting superpixels can be specified with either
<code>k</code> or <code>step</code> arguments. <code>k</code> relates to
the desired number of superpixels. When the <code>k</code> value is set,
the algorithm automatically calculates the value of <code>step</code>.
As, by default, cluster centroids are located regularly, the resulting
number of superpixels may slightly differ from the number provided as
<code>k</code>, e.g., a square raster cannot be divided into five equal
square areas. <code>step</code> is the expected distance, in the number
of cells, between initial superpixels’ centroids. This parameter also
defines a zone of influence of each cluster center
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>S</mi><mo>×</mo><mn>2</mn><mi>S</mi></mrow><annotation encoding="application/x-tex">2S \times 2S</annotation></semantics></math>
region).</p>
<p>In our software, it is also possible to provide a set of points (an
<code>sf</code> object) as <code>k</code> together with the
<code>step</code> value. This way, custom cluster centers are used, with
each of them attracting cells in the surrounding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>S</mi><mo>×</mo><mn>2</mn><mi>S</mi></mrow><annotation encoding="application/x-tex">2S \times 2S</annotation></semantics></math>
region.</p>
<p>While <code>k</code> or <code>step</code> determines the number of
superpixels, the <code>compactness</code> argument controls their
spatial shape, with its large value giving more importance to spatial
distances between cells and superpixels’ centers and its smaller value
putting more weight (importance) to the value distance. The impact of
the compactness value depends on the range of input cell values and the
selected distance measure.</p>
<table class="table">
<caption>Table: Overview of the arguments accepted by the
<code><a href="../reference/supercells.html">supercells()</a></code> function</caption>
<thead><tr class="header">
<th align="left">argument</th>
<th align="left">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><strong><code>x</code></strong></td>
<td align="left">An object of class SpatRaster (terra) or class stars
(stars)</td>
</tr>
<tr class="even">
<td align="left"><strong><code>k</code></strong></td>
<td align="left">A number of superpixels desired by the user. It is also
possible to provide a set of points (an sf object) as k together with
the step value to create custom cluster centers</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>compactness</code></strong></td>
<td align="left">A compactness value. Larger values cause clusters to be
more compact/even (squarish)</td>
</tr>
<tr class="even">
<td align="left"><code>dist_fun</code></td>
<td align="left">A distance function used</td>
</tr>
<tr class="odd">
<td align="left"><code>avg_fun</code></td>
<td align="left">An averaging function specifying how the values of the
superpixels’ centers are recalculated</td>
</tr>
<tr class="even">
<td align="left"><code>clean</code></td>
<td align="left">A boolean specifying if the additional process of
connectivity enforcement should be performed</td>
</tr>
<tr class="odd">
<td align="left"><code>iter</code></td>
<td align="left">A number of iterations performed to create the final
output</td>
</tr>
<tr class="even">
<td align="left"><code>step</code></td>
<td align="left">A distance, in the number of cells, between initial
superpixels’ centers</td>
</tr>
<tr class="odd">
<td align="left"><code>minarea</code></td>
<td align="left">A minimal size of the output superpixels in cells</td>
</tr>
<tr class="even">
<td align="left"><code>chunks</code></td>
<td align="left">A boolean or numeric value specifying if the input (x)
should be split into chunks before deriving superpixels</td>
</tr>
<tr class="odd">
<td align="left"><code>future</code></td>
<td align="left">A boolean specifying if the future package should be
used for parallelization of the calculations</td>
</tr>
<tr class="even">
<td align="left"><code>verbose</code></td>
<td align="left">An integer specifying the verboseness of text messages
printed during calculations</td>
</tr>
</tbody>
</table>
<p>By default, the <code>supercells</code> function behaves accordingly
to the original algorithm described by <span class="citation">Achanta et
al. (2012)</span> with Euclidean distance used to calculate the distance
between values, and the arithmetic mean used to calculate an average
value of each superpixel. However, in this package, both of the above
parameters can be customized with the <code>dist_fun</code> and
<code>avg_fun</code> arguments.</p>
<p>The role of the <code>dist_fun</code> argument is to specify the
distance function used to obtain the distance between values. It can be
done with one of three mechanisms. The first is to use one of internal
C++ functions, such as <code>"euclidean"</code>, <code>"jsd"</code> (the
Jensen-Shannon distance, <span class="citation">Lin (1991)</span>), and
<code>"dtw"</code> (dynamic time warping). The second mechanism allows
selecting one of 46 distance and similarity measures implemented in the
R package <code>philentropy</code> <span class="citation">(Dorst
2018)</span>. Thirdly, this argument also accepts any user-defined R
function that returns one value based on provided two vectors.</p>
<p>The <code>avg_fun</code> function, on the other hand, specifies how
the values of the superpixels’ centers are calculated. It has two
internal functions implemented in C++ - <code>"mean"</code> and
<code>"median"</code>, but also accepts any fitting R function such as,
<code><a href="https://rdrr.io/r/base/mean.html" class="external-link">base::mean()</a></code> or <code>psych::geometric.mean()</code>. This
also allows providing any other user-defined R function that returns one
value based on an R vector. For example, the <code>"median"</code>
function can be used when our input data is categorical.</p>
<p>Due to its simplicity, the SLIC algorithm does not consider spatial
connectivity directly. For example, it makes it possible to create a
superpixel consisting of two or more distinct patches, where one patch
is large while additional ones are distinctly smaller. The
<code>supercells</code> function has two arguments, <code>clean</code>
and <code>minarea</code>, allowing to enforce connectivity of the
superpixels. The first argument, <code>clean</code>, is a boolean
(<code>TRUE</code> by default) specifying if the connectivity should be
enforced by removing small disconnected patches (by merging with larger
neighborhood ones) or promoting small patches to new superpixels. The
role of the second one, <code>minarea</code>, is to control how large
disconnected patches must be not be removed. By default, when
<code>clean = TRUE</code>, an average area
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>)
is calculated automatically based on the total number of cells divided
by a number of superpixels, and next, the minimal size of a superpixel
equals
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mn>2</mn><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">A/(2^2)</annotation></semantics></math>.
Alternatively, users can also specify the minimum size of a superpixel
by themselves by providing an area in the unit of a number of cells in
the <code>minarea</code> argument.</p>
<p>The next argument is <code>iter</code> - specifying the number of
iterations to create the output. Its default value of 10 follows the
advice by <span class="citation">Achanta et al. (2012)</span> This
argument defines how many times superpixels (and their centers) are
recalculated before obtaining the final results.</p>
<p>By default, the <code>supercells</code> function, as R language, is
single-threaded – runs only on a single thread on the CPU and reads the
input raster values into the computer memory. These features may limit
the function’s usability for raster datasets with millions or more cells
and many variables, for which calculations can either be too slow or
require more memory that is available. To overcome the aforementioned
issues, the <code>supercells</code> function has two related optional
arguments - <code>chunks</code> and <code>future</code>.</p>
<p>The <code>chunks</code> argument is set by default to
<code>FALSE</code>. However, when it is either <code>TRUE</code> or some
numerical value, then the split, apply, combine procedure is used: input
raster is divided into several chunks, each chunk is read into RAM
independently and has a set of superpixels derived; this process is
repeated for every chunk, and all the results are combined into one
final object. When the user sets this argument to <code>TRUE</code>, the
chunks’ sizes are calculated automatically, while when the user provides
a numerical value to this argument, then the input raster data is split
into chunks with user-defined side length (in the number of pixels). The
<code>future</code> argument is also set by default to
<code>FALSE</code>. If it is <code>TRUE</code>, the user also needs to
specify how parallel processing should be performed and on how many CPU
threads with <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code>.</p>
<p>The final argument is called <code>verbose</code>, which takes an
integer value of 0 or larger, where 0 means no additional messages
during the calculations, and 1 provides basic messages about the current
calculation stage.</p>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-achanta2012slic" class="csl-entry">
Achanta, Radhakrishna, Appu Shaji, Kevin Smith, Aurelien Lucchi, Pascal
Fua, and Sabine Süsstrunk. 2012. <span>“SLIC Superpixels Compared to
State-of-the-Art Superpixel Methods.”</span> <em>IEEE Transactions on
Pattern Analysis and Machine Intelligence</em> 34 (11): 2274–82.
</div>
<div id="ref-dorst_philentropy_2018" class="csl-entry">
Dorst, HG. 2018. <span>“Philentropy: <span>Information</span> Theory and
Distance Quantification with <span>R</span>.”</span> <em>Journal of Open
Source Software</em> 3 (26): 765.
</div>
<div id="ref-lin_divergence_1991" class="csl-entry">
Lin, Jianhua. 1991. <span>“Divergence <span>Measures Based</span> on the
<span>Shannon Entropy</span>.”</span> <em>IEEE Transactions on
Information Theory</em> 37 (1): 145–51. <a href="https://doi.org/djxkkh" class="external-link">https://doi.org/djxkkh</a>.
</div>
<div id="ref-Nowosad2022" class="csl-entry">
Nowosad, Jakub, and Tomasz F. Stepinski. 2022. <span>“Extended
<span>SLIC</span> Superpixels Algorithm for Applications to Non-Imagery
Geospatial Rasters.”</span> <em>International Journal of Applied Earth
Observation and Geoinformation</em> 112 (August): 102935. <a href="https://doi.org/10.1016/j.jag.2022.102935" class="external-link">https://doi.org/10.1016/j.jag.2022.102935</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jakub Nowosad.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
